/*! url-shortener - v0.1.0 - 2013-09-22
 * http://royriojas.com
 * Copyright (c) 2013 - Roy Riojas */
!function(a,b){var c=a.astrea.validator;c.getRule("required");var d=function(a){var b=/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/;return b.test(a)};b.validatorRules={"url-validator":function(b){var c=(b.validator,b.val),e=b.field,f=b.callback;b.sender,c=a.trim(c),c.match(/^[a-zA-Z]+:\/\//)||(c="http://"+c,e.val(c));var g=""!==c&&d(c);f(g)}};var e=b.validatorRules;a.each(e,function(a){c.addRule(a,e[a])})}(jQuery,window.kno),function(a,b,c){"use strict";b.tools.createXHRService("kno.services.shortener",[{url:"/shorten",type:"POST",name:"doShort",onResponse:function(a,d){var e=a.url;d.resolve({url:b.format("{0}/{1}",c.location.origin,e)})}}])}(jQuery,kno,window),function(a,b){"use strict";b.on("app:ready",function(a,c){var d=c.$mainContainer,e=c.services,f=e.shortener,g=d.find(".form"),h=d.find(".text-field");h.textentry();var i=g.find(".save");h.on("keydown",function(a){13===a.keyCode&&i.trigger("tap")});var j=function(a){var c=b.format('Congrats! here it is...<br><br> <a href="{0}" class="lnk" target="_blank"><span>{0}</span></a>',a);b.msgBox.alert(c,{modal:!0,title:"Shorten URL",source:i})};g.form({":data:save":function(a,b){var c=b.data.url,d=f.doShort({url:c});d.done(function(a){var b=a.url;j(b)})}})})}(jQuery,kno,window),function(a,b){b.fire("app:init",{SPA:!1})}(jQuery,kno,window);